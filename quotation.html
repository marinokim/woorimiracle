<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotation - Woori Miracle</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            color: #333;
            line-height: 1.6;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }

        .logo img {
            height: 40px;
        }

        .company-info {
            text-align: right;
            font-size: 0.9rem;
        }

        .title {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 40px;
            letter-spacing: 2px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }

        .info-box {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
        }

        .info-box h3 {
            margin: 0 0 10px 0;
            font-size: 1rem;
            color: #666;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        th,
        td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        th {
            background: #f9f9f9;
            font-weight: 600;
            border-top: 2px solid #333;
        }

        td.text-left {
            text-align: left;
        }

        td.text-right {
            text-align: right;
        }

        .total-section {
            text-align: right;
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .footer {
            margin-top: 60px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
        }

        .actions {
            margin-top: 40px;
            text-align: center;
        }

        .btn {
            padding: 10px 25px;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: opacity 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        @media print {
            .actions {
                display: none;
            }

            body {
                padding: 0;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="logo">
            <img src="assets/images/logo/logo.gif" alt="Woori Miracle" loading="lazy">
        </div>
        <div class="company-info">
            <strong>(ì£¼)ìš°ë¦¬ë¯¸ë¼í´</strong><br>
            ëŒ€í‘œ: ê¹€ë³‘ì² <br>
            ì£¼ì†Œ: ì„œìš¸ì‹œ ë™ëŒ€ë¬¸êµ¬ ì¥ì•ˆë™ 347-8 ì •ì€ìŠ¤ì¹´ì´ë¹Œ 201ë™ B101í˜¸<br>
            ì „í™”: 070-4659-0674<br>
            ì´ë©”ì¼: help@woorimiracle.com
        </div>
    </div>

    <div class="title">ê²¬ ì  ì„œ (QUOTATION)</div>

    <div class="info-grid">
        <div class="info-box">
            <h3>ìˆ˜ì‹  (Recipient)</h3>
            <div id="recipient-name">Guest</div>
            <div id="recipient-date">Date: 2023-01-01</div>
        </div>
        <div class="info-box">
            <h3>ê³µê¸‰ì (Supplier)</h3>
            <div>(ì£¼)ìš°ë¦¬ë¯¸ë¼í´</div>
            <div>ë“±ë¡ë²ˆí˜¸: 204-86-35352</div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th style="width: 5%;">No</th>
                <th style="width: 45%;">ìƒí’ˆëª… (Item)</th>
                <th style="width: 15%;">ìˆ˜ëŸ‰ (Qty)</th>
                <th style="width: 15%;">ë‹¨ê°€ (Unit Price)</th>
                <th style="width: 20%;">ê¸ˆì•¡ (Amount)</th>
            </tr>
        </thead>
        <tbody id="quote-items">
            <!-- Items injected here -->
        </tbody>
    </table>

    <div class="total-section">
        ì´ í•©ê³„ (Grand Total): <span id="quote-total" style="color: #0066cc;">â‚©0</span>
    </div>

    <div class="footer">
        <p>ë³¸ ê²¬ì ì„œëŠ” ë°œí–‰ì¼ë¡œë¶€í„° 30ì¼ê°„ ìœ íš¨í•©ë‹ˆë‹¤.</p>
        <p>This quotation is valid for 30 days from the date of issue.</p>
        <br>
        <p>(ì£¼)ìš°ë¦¬ë¯¸ë¼í´</p>
    </div>

    <div class="actions">
        <button class="btn" onclick="saveQuotationRequest()" style="background: #4CAF50; margin-right: 10px;">ğŸ’¾ ê²¬ì  ìš”ì²­
            ì €ì¥</button>
        <button class="btn" onclick="window.location.href='cart.html'"
            style="background: #666; margin-right: 10px;">ì¥ë°”êµ¬ë‹ˆë¡œ ëŒì•„ê°€ê¸°</button>
        <button class="btn" onclick="window.location.href='products.html'"
            style="background: #0066cc; margin-right: 10px;">ì œí’ˆ ì¶”ê°€í•˜ê¸°</button>
        <button class="btn" onclick="window.print()">ì¸ì‡„ / PDF ì €ì¥</button>
    </div>

    <script src="js/user.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/quotation-manager.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. User Info
            const sessionUser = JSON.parse(sessionStorage.getItem('wm_user_session'));
            const userName = sessionUser ? sessionUser.name : 'Guest (ë¹„íšŒì›)';
            document.getElementById('recipient-name').innerText = userName;

            // 2. Date
            const today = new Date();
            const dateStr = today.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('recipient-date').innerText = `Date: ${dateStr}`;

            // 3. Cart Items
            const cartItems = JSON.parse(sessionStorage.getItem('wm_cart')) || [];
            const tbody = document.getElementById('quote-items');
            let total = 0;

            if (cartItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="padding: 30px;">ê²¬ì í•¨ì— ë‹´ê¸´ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            } else {
                cartItems.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td class="text-left">
                            <div style="font-weight: 600;">${item.name}</div>
                            <div style="font-size: 0.8rem; color: #888;">${item.category}</div>
                        </td>
                        <td>${item.quantity}</td>
                        <td class="text-right">â‚©${item.price.toLocaleString()}</td>
                        <td class="text-right">â‚©${itemTotal.toLocaleString()}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            // 4. Total
            document.getElementById('quote-total').innerText = `â‚©${total.toLocaleString()}`;
        });

        // ê²¬ì  ìš”ì²­ ì €ì¥ í•¨ìˆ˜
        function saveQuotationRequest() {
            const cartItems = JSON.parse(sessionStorage.getItem('wm_cart')) || [];

            if (cartItems.length === 0) {
                alert('ê²¬ì í•¨ì— ë‹´ê¸´ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const sessionUser = JSON.parse(sessionStorage.getItem('wm_user_session'));
            let customerInfo = {};

            if (!sessionUser) {
                // ë¹„íšŒì›ì¸ ê²½ìš° ì •ë³´ ì…ë ¥ ë°›ê¸°
                const userName = prompt('íšŒì‚¬ëª… ë˜ëŠ” ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:');
                if (!userName) return;

                const userPhone = prompt('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
                if (!userPhone) return;

                customerInfo = {
                    userName: userName,
                    userPhone: userPhone,
                    userCompany: userName,
                    userEmail: ''
                };
            }

            const customerNote = prompt('ê²¬ì  ìš”ì²­ ë©”ëª¨ (ì„ íƒì‚¬í•­):', '');

            // ì´ì•¡ ê³„ì‚°
            const totalAmount = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            // ê²¬ì  ì €ì¥
            const savedQuotation = quotationManager.add({
                items: cartItems,
                totalAmount: totalAmount,
                customerNote: customerNote || '',
                ...customerInfo
            });

            if (savedQuotation) {
                alert('ê²¬ì  ìš”ì²­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê²¬ì  ë²ˆí˜¸: ' + savedQuotation.id + '\n\nê³„ì† ì‡¼í•‘í•˜ì‹œê±°ë‚˜ ê²¬ì  ë‚´ì—­ì€ ìƒë‹¨ "ğŸ“‹ ë‚´ ê²¬ì " ë©”ë‰´ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');

                // ì œí’ˆ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = 'products.html';
            }
        }
    </script>
</body>

</html>